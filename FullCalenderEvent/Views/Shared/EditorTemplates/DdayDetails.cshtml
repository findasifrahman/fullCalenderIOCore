@model FullCalenderEvent.Models.DdayDetails

@{
    ViewBag.Title = "Create";
}
<script type="text/javascript">
        var specialKeys = new Array();
        specialKeys.push(8); //Backspace
        specialKeys.push(9); //Tab
        specialKeys.push(46); //Delete
        specialKeys.push(36); //Home
        specialKeys.push(35); //End
        specialKeys.push(37); //Left
        specialKeys.push(39); //Right
        function IsAlphaNumeric(e) {
            var keyCode = e.keyCode == 0 ? e.charCode : e.keyCode;
            var ret = ((keyCode >= 48 && keyCode <= 57) || (keyCode >= 65 && keyCode <= 90) || (keyCode >= 97 && keyCode <= 122) || (specialKeys.indexOf(e.keyCode) != -1 && e.charCode != e.keyCode));
            //document.getElementById("error").style.display = ret ? "none" : "inline";
            return ret;
        }
</script>

@section Scripts{
    <script type="text/javascript">
        var specialKeys = new Array();
        specialKeys.push(8); //Backspace
        specialKeys.push(9); //Tab
        specialKeys.push(46); //Delete
        specialKeys.push(36); //Home
        specialKeys.push(35); //End
        specialKeys.push(37); //Left
        specialKeys.push(39); //Right
        specialKeys.push(32); //Right
        specialKeys.push(189); //Right
        function IsAlphaNumeric(e) {
            var keyCode = e.keyCode == 0 ? e.charCode : e.keyCode;
            var ret = ((keyCode >= 48 && keyCode <= 57) || (keyCode >= 65 && keyCode <= 90) || (keyCode >= 97 && keyCode <= 122) || (specialKeys.indexOf(e.keyCode) != -1 && e.charCode != e.keyCode || keyCode == 32) || keyCode == 189);
            //document.getElementById("error").style.display = ret ? "none" : "inline";
            return ret;
        }
    </script>

    <script>

        $(document).ready(function () {
            $('#Subject').siblings('span.error').css('visibility', 'hidden');
            $('#Description').siblings('span.error').css('visibility', 'hidden');
            $('#start').siblings('span.error').css('visibility', 'hidden');


            var DdayDetails = [];


            $('#add').click(function () {
                var isValidItem = true;

                if ($('#Subject').val().trim() == '') {
                    //isValidItem = false;
                    $('#Subject').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    $('#Subject').siblings('span.error').css('visibility', 'hidden');
                }
                if ($('#Description').val().trim() == '') {
                    isValidItem = false;
                    $('#Description').siblings('span.error').css('visibility', 'visible');
                }
                else {
                    $('#Description').siblings('span.error').css('visibility', 'hidden');
                }

                if (isValidItem)
                {
                    DdayDetails.push({
                        Subject: $('#Subject').val().trim(),
                        Description: $('#Description').val().trim(),
                        start: $('#start').val().trim(),
                        end: $('#end').val().trim(),
                        Color: $('#Color').val().trim(),
                        isFullDay: $('#isFullDay').val().trim()
                    });
                }
                GeneratedItemsTable();
            });

            function GeneratedItemsTable() {
                //if (VoucherDetail.length > 0)
                {
                    var $table = $('<table class="table"/>');
                    $table.append('<thead><th >Subject</th><th style="text-align:center">Description</th><th style="text-align:center">Start</th><th style="text-align:center">End</th><th style="text-align:center">Color</th><th style="text-align:center">IsFullDay</th><th style="text-align:right"></th></tr></thead>');
                    var $tbody = $('<tbody/>');
                    $.each(DdayDetails, function (i, val) {
                        var $row = $('<tr/>');
                        $row.append($('<td />').html(val.Subject));
                        $row.append($('<td  style="text-align:center"/>').html(val.Description));
                        $row.append($('<td  style="text-align:center"/>').html(val.start));
                        $row.append($('<td  style="text-align:center"/>').html(val.end));
                        $row.append($('<td  style="text-align:center"/>').html(val.Color));
                        $row.append($('<td  style="text-align:center"/>').html(val.isFullDay));
                        var $remove = $('<a href="#">Remove</a>');
                        $remove.click(function (e) {
                            e.preventDefault();
                            DdayDetails.splice(i, 1);
                            GeneratedItemsTable();
                        });
                        $row.append($('<td style="color:red;text-align:right"/>').html($remove));
                        $tbody.append($row);
                    });
                    console.log("current", DdayDetails);
                    $table.append($tbody);
                    $('#DdayDetails').html($table);

                }

            }
            //////////
            $('#submit').click(function () {
                var isAllValid = true;

                if ($('#EventDay').val().trim() == '') {
                    $('#EventDay').siblings('span.error').css('visibility', 'visible');
                    isAllValid = false;
                }
                else {
                    $('#EventDay').siblings('span.error').css('visibility', 'hidden');
                }
                if ($('#Dday').val().trim() == '') {
                    $('#Dday').siblings('span.error').css('visibility', 'visible');
                    isAllValid = false;
                }
                else {
                    $('#Dday').siblings('span.error').css('visibility', 'hidden');
                }

                //if (isAllValid)
                {

                    var data = {
                        SubjectName: $('#EventDay').val().trim(),
                        Dday: $('#Dday').val().trim(),
                        DdayDetails: DdayDetails
                    }
                }
                $(this).val('Please wait...');

                $.ajax({
                    url: '/eventDdays/Create',
                    type: "POST",
                    data: JSON.stringify(data),
                    dataType: "JSON",
                    contentType: "application/json",
                    success: function (d) {
                        //check is successfully save to database
                        if (d.status == true) {
                            alert('Successfully done.');
                            window.location.href = "/eventDdays/Index";
                            //clear form

                        }
                        else {
                            alert('Failed');
                        }
                        $('#submit').val('Save');
                    },
                    error: function () {
                        alert('Error. Please try again.');
                        $('#submit').val('Save');
                    }
                });

            });



        })

    </script>
}

<div class="container">
    <h2 style="text-align:center;color:whitesmoke">Create New Event</h2>

    <div class="form-horizontal">
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="row col-md-12">
            <div class="col-md-6">
                <div class="form-group">
                    @Html.Label("EventDay", htmlAttributes: new { @class = "control-label col-md-2" })
                    <div class="col-md-4">
                        <input type="text" id="EventDay" class="form-control" onkeypress="return IsAlphaNumeric(event);"
                               ondrop="return false;" onpaste="return IsAlphaNumeric(event);" />
                        <span class="error text-danger">EventDay Required</span>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    @Html.Label("Dday Date", htmlAttributes: new { @class = "control-label col-md-2" })
                    <div class="col-md-4">
                        <input type="datetime-local" id="Dday" class="form-control" />
                        <span class="error text-danger">Date required</span>
                    </div>
                </div>
            </div>
        </div>

        <br />


        <div class="form-group">
            <h4 style="text-align:center;color:whitesmoke">DdayDetails Details</h4>
            <div class="table-responsive">
                <table id="myTable" class="table">
                    <tr>
                        <td style="text-align:center">Subject</td>
                        <td style="text-align:center">Description</td>
                        <td style="text-align:center">start </td>
                        <td style="text-align:center">end </td>
                        <td style="text-align:center">Color </td>
                        <td style="text-align:center">isFullDay  </td>
                        <td style="text-align:right">&nbsp;</td>
                    </tr>
                    <tr>
                        <td>
                            <input class="form-control" type="text" name="Subject" id="Subject" onkeypress="return IsAlphaNumeric(event);"
                                   ondrop="return false;" onpaste="return IsAlphaNumeric(event);" />
                            <span class="error text-danger">Subject required</span>
                        </td>
                        <td>
                            <input class="form-control" type="text" name="Description" id="Description" />
                            <span class="error text-danger">Description required</span>
                        </td>
                        <td>
                            <input class="form-control" name="start" id="start" type="datetime-local" />
                            <span class="error text-danger">start Date required</span>
                        </td>
                        <td>
                            <input class="form-control" name="end" id="end" type="datetime-local" />

                        </td>
                        <td>
                            <select name="Color" id="Color" class="form-control">
                                <option value="red">Red</option>
                                <option value="green">Green</option>
                                <option value="blue">Blue</option>
                                <option value="black">Black</option>
                            </select>
                        </td>
                        <td>
                            <input class="form-control" name="isFullDay" id="isFullDay" type="checkbox" />
                            
                        </td>
                        <td>
                            <input type="button" id="add" value="add" class="btn btn-info" />
                        </td>
                    </tr>
                </table>
            </div>
            <div id="DdayDetails" class="table-responsive">
            </div>
            <br />
            <input style="width:100%" id="submit" type="button" value="Save" class="btn btn-info" />
        </div>

    </div>


</div>
